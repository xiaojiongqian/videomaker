# 如何用 Codex/CC 实现长时间并行 Vibe Coding

> 一句话总结：通过 Full Access 模式 + Git Worktree + MCP 工具 + 自定义 Skill，实现多任务并行、长时间无人值守的 AI 辅助编程。

## 一、背景与需求

用 Claude Code 或 Codex 这类工具做 Vibe Coding 的时候，大家可能都遇到过这些痛点：

1. **频繁打断**：IDE 插件总是弹窗让你确认，一两分钟就打断一次
2. **单线程工作**：一次只能处理一个任务，效率上不去
3. **安全担忧**：担心 AI 乱改代码，把项目搞坏

![单线程 vs 并行工作流对比](images/diagram_comparison.svg)
*单线程开发 vs 并行开发对比：并行模式可同时执行多个任务，效率提升*

这篇文章分享一套经过实践验证的工作流，解决这三个问题。

## 二、解决方案

### 2.1 使用 CLI 客户端 + Full Access 模式

**为什么不用 IDE 插件？**

Cursor 这类 IDE 插件虽然方便，但即使开了 Full Access Mode，实际上还是会不停地弹窗确认，可能一两分钟就打断一次，只能单线程工作。

**推荐做法**：使用 Claude Code CLI 客户端，开启 Full Access 模式。

![Full Access 模式设置](images/full_access_mode.jpg)
*Claude Code 的 Agent (full access) 模式，实现长时间不打断*

实测最长跑过 8 小时的任务，完全不需要人工干预。当然，一些危险操作它还是会提示确认的。

### 2.2 多窗口并行工作流架构

一个人同时跑 3-4 个并行任务是比较合适的，再多就不太好控制了，因为涉及到上下文切换和代码冲突问题。

![多窗口并行工作流架构](images/diagram_architecture.svg)
*多窗口并行工作流架构：主控窗口管理多个 Worktree，每个独立运行*

**架构说明**：
- **主控窗口**：负责任务分配和进度管理
- **Worktree A/B/C**：独立工作空间，分别处理不同模块
- **Codex CLI**：每个窗口独立运行，自主执行任务
- **Git Repository**：统一代码管理，通过 PR 合并

**关键原则**：每个任务最好处理不同的模块，互相不干扰，这样合并代码会比较方便。

### 2.3 Git Worktree 隔离工作空间

为了让多个任务能够并行而不冲突，使用 Git Worktree 是个好办法：

- 每个 Worktree 是一个独立的工作目录
- 可以在不同的 Worktree 里独立工作
- 代码提交在各自的分支上，不会互相影响
- 最后通过 PR 合并到主分支

**安全约束**：
- 只允许在 Worktree 分支上提交代码
- 不允许直接提交到 dev 或 main 分支
- 必须通过 PR 流程合并

### 2.4 MCP 工具扩展能力

要让 AI 能够自动完成更多工作，需要给它"手脚"——也就是 MCP 工具。

![MCP 工具列表](images/mcp_tools_list.jpg)
*Playwright MCP 提供的自动化测试工具*

比如做前端开发，安装 Playwright MCP 后，AI 就能自动：
- 打开浏览器访问页面
- 点击按钮、填写表单
- 截图验证界面效果
- 运行端到端测试

安装很简单，告诉 Claude Code "帮我配置 Playwright MCP"，它就会自动完成配置。

### 2.5 自定义 Skill 实现自动化开发

除了 MCP，还可以创建自定义 Skill 来规范 AI 的工作流程：

```
触发命令：/auto-dev
功能：在当前 worktree 分支上自动开发
约束：
- 不允许直接修改 dev 和 main 分支
- 只处理当前分支的代码
- 可以自动部署到测试环境
```

这样一来，只要触发 `/auto-dev`，AI 就会按照预设的流程自动工作。

## 三、任务执行流程

完整的任务执行流程如下：

![任务执行流程](images/diagram_flow.svg)
*任务执行流程：从创建 Worktree 到合并代码的完整步骤*

**流程说明**：
1. **创建 Git Worktree**：为每个任务创建独立工作空间
2. **启动 Codex CLI**：在对应 Worktree 中启动 AI 助手
3. **AI 自主执行任务**：代码编写、测试验证、文档更新
4. **完成判断**：检查任务是否完成
5. **提交代码**：将代码提交到对应分支
6. **合并到主分支**：通过 PR 流程合并代码

### 3.1 主控窗口管理迭代

建议开一个"主控窗口"来管理整体进度：

在主控窗口里可以：
- 查看当前迭代的任务列表
- 回顾哪些已完成、哪些还没做
- 分配新任务给其他窗口

### 3.2 实时处理小优化

在开发过程中发现的小问题，可以随时记录并分配给空闲的窗口处理：

比如发现某个 UI 元素被遮挡了，就可以开个新任务让 AI 去修复，不影响主线开发。

### 3.3 自动化测试验证

配合 Playwright MCP，AI 可以自动：
- 运行测试用例
- 验证界面效果
- 发现问题自动修复
- 生成测试报告

整个过程完全自动化，不需要人工操作。

### 3.4 PR 合并流程

当一个任务完成后：
1. AI 自动提交代码到 worktree 分支
2. 创建 PR 请求合并
3. 在主控窗口执行 PR 合并命令
4. 自动完成代码审查和合并

## 四、总结

实现长时间并行 Vibe Coding 的四个关键点：

| 要点 | 做法 |
|------|------|
| **不打断** | 用 CLI 客户端 + Full Access 模式 |
| **并行工作** | 多窗口 + Git Worktree 隔离 |
| **扩展能力** | MCP 工具（如 Playwright）+ 自定义 Skill |
| **安全可控** | 分支保护 + PR 流程 + 模块化分工 |

这套工作流经过实际项目验证，可以显著提升 AI 辅助编程的效率。当然，AI 工具发展很快，这个方案可能过段时间就需要更新了，但核心思路——**自动化、并行化、安全隔离**——应该是通用的。
