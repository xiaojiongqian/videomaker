# 智能视频剪辑 V2 - 改进说明

## 主要改进

### 1. 分层剪辑策略

按照以下优先级顺序处理，确保最小化内容损失：

1. **第1层：裁剪没声音部分**
   - 移除空白片段（无字幕内容）
   - 完全无损，不影响任何内容

2. **第2层：剪语气词**
   - 移除"嗯"、"啊"、"那个"、"就是"等语气词和填充词
   - 支持中英文语气词识别
   - 低损，不影响内容理解

3. **第3层：剪重复内容**
   - 移除重复语义片段（相似度 > 80%）
   - 移除口误和自我纠正
   - 保留重要性更高的版本

4. **第4层：加速播放**
   - 使用 1.0x - 1.5x 加速播放
   - 保留所有内容，只是缩短时间
   - 使用 FFmpeg 的 `setpts` 和 `atempo` 滤镜
   - 音频保持音调不变

5. **第5层：剪除低价值内容**
   - 最后手段，只在前4层不够时使用
   - 按内容重要性排序（1-10分）
   - 优先保留重要性 >= 7 的片段

### 2. 内容重要性评估

每个片段都会被评估重要性（1-10分），考虑因素：

- **文本长度**：长文本通常更重要
- **关键词**：技术术语、逻辑连接词（"首先"、"因此"、"关键"等）
- **问句**：引出重要内容的问题
- **位置**：开头和结尾的片段更重要
- **连贯性**：与前后文差异大的新话题更重要

### 3. 全局扫描避免不均衡

- 先计算所有片段的重要性
- 再按层级逐步处理
- 确保不会"前面剪掉重要内容，后面还有空档"

## 使用方法

### 基本用法

```bash
# 智能剪辑，自动移除冗余（第1-3层）
/smart-cut video/example.mp4

# 指定压缩 30% 的时长（会使用第4-5层）
/smart-cut video/example.mp4 30%

# 压缩一半时长（会使用加速+剪除）
/smart-cut video/example.mp4 50%
```

### 直接使用脚本

```bash
# 分析阶段
python3 scripts/smart_cut_analysis_v2.py video.srt 0.5

# 执行剪辑
python3 scripts/smart_cut_execute_v2.py video_cut_result.json video.mp4
```

## 输出示例

```
=== 智能剪辑分层策略 ===
策略顺序：
  1. 裁剪没声音部分（空白片段）
  2. 剪语气词和填充词
  3. 剪重复语义内容
  4. 使用加速播放（最多1.5倍）
  5. 剪除低价值内容（最后手段）

执行第1-3层分析...
  第1层：检测空白片段（无声音）
    找到 15 个空白片段
  第2层：检测语气词和填充词
    找到 42 个语气词/填充词片段
  第3层：检测重复语义内容
    找到 18 个重复/纠正片段

第1-3层处理结果：
  移除片段总数: 75
    - 空白片段: 15
    - 语气词/填充词: 42
    - 重复内容: 18
  保留时长: 450.5秒 (7.5分钟)
  压缩比: 35.2%

目标调整策略（分层处理）：
  原始时长: 695.0秒
  目标时长: 347.5秒
  当前保留: 450.5秒 (已剪除空白/语气词/重复)
  需要减少: 103.0秒

  第4层策略: 使用 1.3x 加速播放
  预计时长: 346.5秒

=== 最终结果 ===
保留片段: 245 个
最终时长: 346.5秒 (5.8分钟)
最终压缩比: 50.1%
播放速度: 1.30x
```

## 技术细节

### 加速播放实现

使用 FFmpeg 滤镜：

```bash
# 视频加速（1.5倍）
[0:v]trim=start=10:end=20,setpts=PTS-STARTPTS,setpts=PTS/1.5[v0]

# 音频加速（保持音调）
[0:a]atrim=start=10:end=20,asetpts=PTS-STARTPTS,atempo=1.5[a0]
```

### 分批处理

- 每批处理 20 个片段
- 避免 FFmpeg 命令过长
- 使用 concat demuxer 合并批次

## 文件说明

### V2 版本（推荐）
- `scripts/smart_cut_analysis_v2.py` - 支持分层策略和加速播放的分析脚本
- `scripts/smart_cut_execute_v2.py` - 支持加速播放的执行脚本

### V1 版本（旧版）
- `scripts/smart_cut_analysis.py` - 基础分析脚本
- `scripts/smart_cut_execute.py` - 基础执行脚本

## 对比

| 特性 | V1 | V2 |
|------|----|----|
| 空白片段检测 | ✓ | ✓ |
| 语气词识别 | 基础 | 增强（中英文） |
| 重复内容检测 | ✓ | ✓ + 重要性评估 |
| 加速播放 | ✗ | ✓ (1.0-1.5x) |
| 分层策略 | ✗ | ✓ |
| 内容重要性评估 | ✗ | ✓ (1-10分) |
| 全局扫描 | 部分 | ✓ |

## 建议

1. **首次使用**：不指定压缩比，让系统自动处理第1-3层
2. **需要更短**：指定目标压缩比（如 40%），系统会自动使用加速
3. **极限压缩**：指定 50% 以上，系统会使用加速+剪除
4. **保留原速**：如果不想加速，可以指定较小的压缩比（< 30%）

## 注意事项

- 加速播放最多 1.5 倍，超过会影响观看体验
- 音频使用 `atempo` 滤镜保持音调，不会出现"花栗鼠"效果
- 高重要性内容（>= 7分）会被优先保留
- 建议先测试小片段，确认效果后再处理完整视频
